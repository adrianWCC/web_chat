(function(t){function e(e){for(var r,i,o=e[0],c=e[1],u=e[2],d=0,p=[];d<o.length;d++)i=o[d],n[i]&&p.push(n[i][0]),n[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);l&&l(e);while(p.length)p.shift()();return a.push.apply(a,u||[]),s()}function s(){for(var t,e=0;e<a.length;e++){for(var s=a[e],r=!0,o=1;o<s.length;o++){var c=s[o];0!==n[c]&&(r=!1)}r&&(a.splice(e--,1),t=i(i.s=s[0]))}return t}var r={},n={app:0},a=[];function i(e){if(r[e])return r[e].exports;var s=r[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=r,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var l=c;a.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"0f92":function(t,e,s){"use strict";var r=s("e249"),n=s.n(r);n.a},1376:function(t,e,s){"use strict";var r=s("9a7e"),n=s.n(r);n.a},"56d7":function(t,e,s){"use strict";s.r(e);s("cadf"),s("551c"),s("f751"),s("097d");var r=s("2b0e"),n=s("5132"),a=s.n(n),i=s("2f62"),o=s("0e44"),c={setMsg:function(t,e){t.msgList.push(e)},setUser:function(t,e){t.user=Object.assign({},t.user,e)},setSocketId:function(t,e){t.socketId=e},delSocketId:function(t){t.socketId=null}},u={};r["default"].use(i["a"]);var l={socketId:"",user:{name:"",avatar:"",desc:"",id:""}},d=new i["a"].Store({state:l,mutations:c,getters:u,plugins:[Object(o["a"])({storage:window.sessionStorage})]}),p=s("8c4f"),f=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page"},[s("Row",{staticClass:"row"},[s("i-Col",{staticClass:"left-box",attrs:{span:"7"}},[s("Tabs",{attrs:{animated:!1}},[s("TabPane",{attrs:{label:"Message"}},[t._l(t.customs,function(e){return[s("UserList",{key:e.id,attrs:{src:e.avatar,user:e,owerId:t.user.id},on:{handeleSelect:t.handleSelect}})]})],2),s("TabPane",{attrs:{label:"Topic"}},[t._v("Topic")])],1)],1),s("i-Col",{staticClass:"right-box",attrs:{span:"16",offset:"1"}},[s("div",{staticClass:"split"},[s("Split",{attrs:{mode:"vertical"},model:{value:t.split,callback:function(e){t.split=e},expression:"split"}},[s("div",{staticClass:"split-pane",attrs:{slot:"top"},slot:"top"},[s("div",{staticClass:"title"},[s("Avatar",{staticClass:"avatar",attrs:{shape:"square",src:t.target.avatar}})],1),s("ul",{staticClass:"msg-box"},[t._l(t.target.msgList,function(e,r){return[e.fromId!==t.user.id?s("li",{key:r,staticClass:"msg-item msg-item-left"},[s("Avatar",{staticClass:"avatar",attrs:{shape:"square",src:t.target.avatar}}),s("span",{staticClass:"msg"},[t._v(t._s(e.msg))])],1):s("li",{key:r,staticClass:"msg-item msg-item-right"},[s("span",{staticClass:"msg"},[t._v(t._s(e.msg))]),s("Avatar",{staticClass:"avatar",attrs:{shape:"square",src:t.user.avatar}})],1)]})],2)]),s("div",{staticClass:"split-pane",attrs:{slot:"bottom"},slot:"bottom"},[s("Input",{staticClass:"send-box",attrs:{type:"textarea",placeholder:"Enter something..."},on:{"on-keypress":t.handleSendMsg},model:{value:t.sendMsg,callback:function(e){t.sendMsg=e},expression:"sendMsg"}})],1)])],1)])],1)],1)},m=[],h=(s("55dd"),s("75fc")),g=(s("ac6a"),s("96cf"),s("3b8d")),v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"list",on:{click:t.handeleSelect}},[s("div",{staticClass:"list-avatar"},[s("Badge",{attrs:{count:t.count,offset:[],"class-name":"badge"}},[s("Avatar",{attrs:{shape:"square",size:"large",src:t.user.avatar}})],1),t.user.socketId?t._e():s("span",{staticClass:"shape"})],1),s("div",{staticClass:"list-content"},[s("p",{staticClass:"title"},[t._v(t._s(t.user.name))]),s("p",{staticClass:"desc"},[t._v(t._s(t.user.desc))])])])},b=[],k={name:"UserList",props:["user","owerId"],methods:{handeleSelect:function(){this.$emit("handeleSelect",this.user)}},computed:{count:function(){var t=this;return this.user.id===this.owerId?0:this.user.msgList?this.user.msgList.filter(function(e){return e.toId===t.owerId&&!1===e.mark}).length:0}}},w=k,x=(s("a973"),s("2877")),I=Object(x["a"])(w,v,b,!1,null,null,null),_=I.exports,y={name:"Index",data:function(){return{split:.5,sendMsg:"",src:"https://i.loli.net/2017/08/21/599a521472424.jpg",customs:[],msgList:[],lastMsg:{},targetId:null}},mounted:function(){var t=Object(g["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getUserList();case 2:this.getMsgList();case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{handleSendMsg:function(t){"Enter"===t.key&&(t.preventDefault(),this.$socket.emit("chat message",{source:this.user,msg:this.sendMsg,target:this.target}),this.sendMsg="")},handleSelect:function(t){t.id!==this.user.id&&(this.targetId=t.id,this.mark(),this.$socket.emit("chatRead",this.targetId))},mark:function(){var t=this,e=this.customs.filter(function(e){return e.id===t.targetId})[0].msgList||[];e.forEach(function(t){t.mark=!0}),this.customs=JSON.parse(JSON.stringify(this.customs))},getUserList:function(){var t=Object(g["a"])(regeneratorRuntime.mark(function t(){var e,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$api.get("/users");case 2:e=t.sent,s=e.code,r=e.data,s&&(this.customs=r);case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),getMsgList:function(){var t=Object(g["a"])(regeneratorRuntime.mark(function t(){var e,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$api.get("/msg?id=".concat(this.user.id));case 2:e=t.sent,s=e.code,r=e.result,s&&(this.msgList=r);case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},computed:{user:function(){return this.$store.state.user},target:function(){var t=this;return this.customs.filter(function(e){return e.id===t.targetId})[0]||{}}},watch:{lastMsg:{handler:function(t){var e=this;t.fromId===this.target.id&&(this.lastMsg.mark=!0,this.$socket.emit("chatRead",this.targetId)),this.customs.forEach(function(e){e.id!==t.fromId&&e.id!==t.toId||(e.msgList?e.msgList.push(t):e.msgList=[t])}),this.$nextTick(function(){e.customs=JSON.parse(JSON.stringify(e.customs))})}},msgList:{deep:!0,immediate:!0,handler:function(t){var e=this;if(t){for(var s=0;s<t.length;s++)for(var r=t[s],n=0;n<this.customs.length;n++){var a=this.customs[n];-1!==r.sign.indexOf(a.id)&&(a.msgList?a.msgList=[].concat(Object(h["a"])(a.msgList),Object(h["a"])(r.list)):a.msgList=Object(h["a"])(r.list),a.msgList.sort(function(t,e){return t.time-e.time}))}this.$nextTick(function(){e.customs=JSON.parse(JSON.stringify(e.customs))})}}}},components:{UserList:_},sockets:{connect:function(){},customEmit:function(t){this.$store.commit("setMsg",t)},updateUserList:function(){var t=Object(g["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getUserList();case 2:this.getMsgList;case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),newMsg:function(t){this.lastMsg=t}}},O=y,$=(s("0f92"),Object(x["a"])(O,f,m,!1,null,"4031db89",null)),L=$.exports,C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page"},[s("div",{staticClass:"login-box"},[s("i-form",{attrs:{model:t.form,rules:t.form.rule},nativeOn:{submit:function(t){t.preventDefault()}}},[s("FormItem",{attrs:{prop:"user"}},[s("i-input",{model:{value:t.form.user,callback:function(e){t.$set(t.form,"user",e)},expression:"form.user"}},[s("Icon",{attrs:{slot:"prepend",type:"ios-person-outline"},slot:"prepend"})],1)],1),s("FormItem",{attrs:{prop:"password"}},[s("i-input",{attrs:{type:"password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}},[s("Icon",{attrs:{slot:"prepend",type:"ios-lock-outline"},slot:"prepend"})],1)],1),s("FormItem",[s("Button",{attrs:{type:"primary"},on:{click:t.login}},[t._v("登录/注册")])],1)],1)],1)])},S=[],j={name:"Login",data:function(){return{form:{user:"",password:"",rule:{user:[{required:!0,message:"Please fill in the user name",trigger:"blur"}],password:[{required:!0,message:"Please fill in the password.",trigger:"blur"},{type:"string",min:6,message:"The password length cannot be less than 6 bits",trigger:"blur"}]}}}},methods:{login:function(){var t=Object(g["a"])(regeneratorRuntime.mark(function t(){var e,s,r,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$api.post("/login",{name:this.form.user,pwd:this.form.password,socketId:this.socketId});case 2:if(e=t.sent,s=e.code,r=e.user,n=e.data,!s){t.next=11;break}return this.$store.commit("setUser",r),this.$router.push({path:"/"}),this.$socket.emit("update_socket_id",{userId:r.id,socketId:this.$socket.id}),t.abrupt("return");case 11:this.$Notice.error({title:n});case 12:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},computed:{socketId:function(){return this.$store.state.socketId}}},M=j,R=(s("1376"),Object(x["a"])(M,C,S,!1,null,"278f125b",null)),P=R.exports,E=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},T=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("h1",[t._v("register")])])}],U={name:"Register"},J=U,q=Object(x["a"])(J,E,T,!1,null,null,null),N=q.exports,A=[{path:"/",component:L},{path:"/login",component:P},{path:"/register",component:N}],F=new p["a"]({routes:A}),B=F,D=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},z=[],G={name:"app",sockets:{connect:function(){this.$store.commit("setSocketId",this.$socket.id),this.user.id&&this.$socket.emit("update_socket_id",{userId:this.user.id,socketId:this.$socket.id})},connected:function(){}},computed:{user:function(){return this.$store.state.user}}},H=G,K=Object(x["a"])(H,D,z,!1,null,null,null),Q=K.exports,V=s("bc3a"),W=s.n(V),X=W.a.create({baseURL:"http://localhost:3000",timeout:1e4});X.interceptors.request.use(function(t){return t}),X.interceptors.response.use(function(t){return Promise.resolve(t.data)},function(t){return Promise.resolve({code:!1,data:t})});var Y=X,Z=s("e069"),tt=s.n(Z);s("dcad");r["default"].use(p["a"]),r["default"].use(tt.a),r["default"].config.productionTip=!1,r["default"].prototype.$api=Y,B.beforeEach(function(t,e,s){"/"!==t.fullPath||d.state.user.id?s():s("/login")}),r["default"].use(new a.a({debug:!0,connection:"localhost:3000",vuex:{store:d},options:{path:"/socket/"}})),new r["default"]({render:function(t){return t(Q)},router:B,store:d}).$mount("#app")},"9a7e":function(t,e,s){},a973:function(t,e,s){"use strict";var r=s("b3a4"),n=s.n(r);n.a},b3a4:function(t,e,s){},e249:function(t,e,s){}});
//# sourceMappingURL=app.b695f6c9.js.map